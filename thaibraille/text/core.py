# -*- coding: utf-8 -*-
import re
from pythainlp.util import Trie
from pythainlp.tokenize import word_tokenize

thai_braille_mapping_dict = {
    "ก":["1234"],
    "ข":["15"],
    "ฃ":["456", "15"],
    "ค":["156"],
    "ฅ":["56", "156"],
    "ฆ":["6", "156"],
    "ง":["12346"],
    "จ":["234"],
    "ฉ":["25"],
    "ช":["256"],
    "ซ":["2356"],
    "ฌ":["6", "256"],
    "ญ":["6", "12456"],
    "ฎ":["6", "124"],
    "ฏ":["6", "1346"],
    "ฐ":["6", "2345"],
    "ฑ":["6", "23456"],
    "ฒ":["56", "23456"],
    "ณ":["6", "1245"],
    "ด":["124"],
    "ต":["1346"],
    "ถ":["2345"],
    "ท":["23456"],
    "ธ":["456", "23456"],
    "น":["1245"],
    "บ":["1356"],
    "ป":["12356"],
    "ผ":["1235"],
    "ฝ":["1256"],
    "พ":["1246"],
    "ฟ":["1236"],
    "ภ":["6", "1246"],
    "ม":["125"],
    "ย":["12456"],
    "ร":["1345"],
    "ล":["135"],
    "ว":["2346"],
    "ศ":["6", "235"],
    "ษ":["56", "235"],
    "ส":["235"],
    "ห":["134"],
    "ฬ":["6", "135"],
    "อ":["145"],
    "ฮ":["123456"],
    "1":["1"],
    "2":["13"],
    "3":["12"],
    "4":["124"],
    "5":["14"],
    "6":["123"],
    "7":["1234"],
    "8":["134"],
    "9":["23"],
    "0":["234"],
    "๑":["1"],
    "๒":["13"],
    "๓":["12"],
    "๔":["124"],
    "๕":["14"],
    "๖":["123"],
    "๗":["1234"],
    "๘":["134"],
    "๙":["23"],
    "๐":["234"],
    "ะ":['1'],
    "า":['16'],
    "ิ":['13'],
    "ี":['35'],
    "ุ":['12'],
    "ู":['34'],
    "ึ":['236'],
    "ื":['36'],
    "เ":['123'],
    "โ":['23'],
    "ั":['245'],
    "ำ":['1456'],
    "แ":['136'],
    "ไ":['146'],
    "่":['45'],
    "้":['346'],
    "๊":['3456'],
    "๋":['356'],
    "์":['456'],
    "ๆ":['3'],
    " ":['-1'],
    "<N>":['2456']
}

dict_2 = {
    "เ-อ":['126'],
    "เ-ีย":['13456'],
    "เ-ือ":['12345'],
    "-ัว":['14'],
    "เ-า":['345'],
    "เ-าะ":['145', '1']
}

# number start with '2456'

def replace_number(word):
    if word[0] in list("1234567890๐๑๒๓๔๕๖๗๘๙"):
        return '<N>'+word
    return word

thai_braille_mapping_dict = dict(thai_braille_mapping_dict, **dict_2)

_v1=["เ-tอ", "เ-ีtย", "เ-ืtอ", "-ัtว", "เ-tา", "เ-tาะ"]

char_trie = Trie(list(thai_braille_mapping_dict.keys())+_v1+[" ","<N>"])


_vowel_patterns =[i.replace("-","([ก-ฮ])").replace("t","([่้๊๋])")+",\\1"+i.replace("t","")+"\\2" for i in _v1]
_vowel_patterns += [i.replace("-","([ก-ฮ])")+",\\1"+i for i in dict_2.keys()]
_VOWELS = [x.split(",") for x in _vowel_patterns]

def _replace_vowels(word: str) -> str:
    for vowel in _VOWELS:
        word = re.sub(vowel[0], vowel[1], word)

    return word

def thai_word_braille(word: str) -> str:
    word = _replace_vowels(word)
    word = replace_number(word)
    _temp = []
    for i in word_tokenize(word,custom_dict=char_trie, engine="mm"):
       if i.isspace() and len(i)>1:
        for k in list(i):
            _temp.append(thai_braille_mapping_dict[k])
       else:
        _temp.append(thai_braille_mapping_dict[i])
    _b = Braille(_temp)
    return _b.tobraille()


def thai_text_braille(text: str) -> list:
    _list_braille = []
    for word in word_tokenize(text):
        _list_braille.append(thai_word_braille(word))
    return _list_braille


class Braille:
	'''
    List Braille to Braille
	'''
	def __init__(self,data):
		self.inputdata=data
		if isinstance(data, list): # หากข้อมูลเป็นชนิด list
			if len(data)>1: # หากมี list มากกว่าหนึ่ง
				self.data =['']*len(data) # สร้าง list ซ้อน list ตามจำนวนที่มี
				self.i=0
				while self.i<len(data): # ทำการลูปตามจำนวน list ที่ซ้อนใน data
					self.data[self.i] = sorted(list(data[self.i])) #  ทำการแปลงข้อมูลใน list ให้เป็น list
					self.i+=1
			else: # หากมี ['12'] อันเดียว
				self.data =sorted(list(data[0]))
		else:
			self.data = sorted(list(data)) # แปลงเป็น list พร้อมเรียงจากน้อยไปมาก
		# International standard Braille mapping
		# Dots 1,2,3 = left column (top, middle, bottom)
		# Dots 4,5,6 = right column (top, middle, bottom)
		# Dots 7,8 = bottom row (left, right) for 8-dot Braille
		self.db = {
            "-1": " ",
            '0': '⠀',
            '1': '⠁',
            '12': '⠃',
            '123': '⠇',
            '1234': '⠏',
            '12345': '⠟',
            '123456': '⠿',
            '1234567': '⡿',
            '12345678': '⣿',
            '1234568': '⢿',
            '123457': '⡟',
            '1234578': '⣟',
            '123458': '⢟',
            '12346': '⠯',
            '123467': '⡯',
            '1234678': '⣯',
            '123468': '⢯',
            '12347': '⡏',
            '123478': '⣏',
            '12348': '⢏',
            '1235': '⠗',
            '12356': '⠷',
            '123567': '⡷',
            '1235678': '⣷',
            '123568': '⢷',
            '12357': '⡗',
            '123578': '⣗',
            '12358': '⢗',
            '1236': '⠧',
            '12367': '⡧',
            '123678': '⣧',
            '12368': '⢧',
            '1237': '⡇',
            '12378': '⣇',
            '1238': '⢇',
            '124': '⠋',
            '1245': '⠛',
            '12456': '⠻',
            '124567': '⡻',
            '1245678': '⣻',
            '124568': '⢻',
            '12457': '⡛',
            '124578': '⣛',
            '12458': '⢛',
            '1246': '⠫',
            '12467': '⡫',
            '124678': '⣫',
            '12468': '⢫',
            '1247': '⡋',
            '12478': '⣋',
            '1248': '⢋',
            '125': '⠓',
            '1256': '⠳',
            '12567': '⡳',
            '125678': '⣳',
            '12568': '⢳',
            '1257': '⡓',
            '12578': '⣓',
            '1258': '⢓',
            '126': '⠣',
            '1267': '⡣',
            '12678': '⣣',
            '1268': '⢣',
            '127': '⡃',
            '1278': '⣃',
            '128': '⢃',
            '13': '⠅',
            '134': '⠍',
            '1345': '⠝',
            '13456': '⠽',
            '134567': '⡽',
            '1345678': '⣽',
            '134568': '⢽',
            '13457': '⡝',
            '134578': '⣝',
            '13458': '⢝',
            '1346': '⠭',
            '13467': '⡭',
            '134678': '⣭',
            '13468': '⢭',
            '1347': '⡍',
            '13478': '⣍',
            '1348': '⢍',
            '135': '⠕',
            '1356': '⠵',
            '13567': '⡵',
            '135678': '⣵',
            '13568': '⢵',
            '1357': '⡕',
            '13578': '⣕',
            '1358': '⢕',
            '136': '⠥',
            '1367': '⡥',
            '13678': '⣥',
            '1368': '⢥',
            '137': '⡅',
            '1378': '⣅',
            '138': '⢅',
            '14': '⠉',
            '145': '⠙',
            '1456': '⠹',
            '14567': '⡹',
            '145678': '⣹',
            '14568': '⢹',
            '1457': '⡙',
            '14578': '⣙',
            '1458': '⢙',
            '146': '⠩',
            '1467': '⡩',
            '14678': '⣩',
            '1468': '⢩',
            '147': '⡉',
            '1478': '⣉',
            '148': '⢉',
            '15': '⠑',
            '156': '⠱',
            '1567': '⡱',
            '15678': '⣱',
            '1568': '⢱',
            '157': '⡑',
            '1578': '⣑',
            '158': '⢑',
            '16': '⠡',
            '167': '⡡',
            '1678': '⣡',
            '168': '⢡',
            '17': '⡁',
            '178': '⣁',
            '18': '⢁',
            '2': '⠂',
            '23': '⠆',
            '234': '⠎',
            '2345': '⠞',
            '23456': '⠾',
            '234567': '⡾',
            '2345678': '⣾',
            '234568': '⢾',
            '23457': '⡞',
            '234578': '⣞',
            '23458': '⢞',
            '2346': '⠮',
            '23467': '⡮',
            '234678': '⣮',
            '23468': '⢮',
            '2347': '⡎',
            '23478': '⣎',
            '2348': '⢎',
            '235': '⠖',
            '2356': '⠶',
            '23567': '⡶',
            '235678': '⣶',
            '23568': '⢶',
            '2357': '⡖',
            '23578': '⣖',
            '2358': '⢖',
            '236': '⠦',
            '2367': '⡦',
            '23678': '⣦',
            '2368': '⢦',
            '237': '⡆',
            '2378': '⣆',
            '238': '⢆',
            '24': '⠊',
            '245': '⠚',
            '2456': '⠺',
            '24567': '⡺',
            '245678': '⣺',
            '24568': '⢺',
            '2457': '⡚',
            '24578': '⣚',
            '2458': '⢚',
            '246': '⠪',
            '2467': '⡪',
            '24678': '⣪',
            '2468': '⢪',
            '247': '⡊',
            '2478': '⣊',
            '248': '⢊',
            '25': '⠒',
            '256': '⠲',
            '2567': '⡲',
            '25678': '⣲',
            '2568': '⢲',
            '257': '⡒',
            '2578': '⣒',
            '258': '⢒',
            '26': '⠢',
            '267': '⡢',
            '2678': '⣢',
            '268': '⢢',
            '27': '⡂',
            '278': '⣂',
            '28': '⢂',
            '3': '⠄',
            '34': '⠌',
            '345': '⠜',
            '3456': '⠼',
            '34567': '⡼',
            '345678': '⣼',
            '34568': '⢼',
            '3457': '⡜',
            '34578': '⣜',
            '3458': '⢜',
            '346': '⠬',
            '3467': '⡬',
            '34678': '⣬',
            '3468': '⢬',
            '347': '⡌',
            '3478': '⣌',
            '348': '⢌',
            '35': '⠔',
            '356': '⠴',
            '3567': '⡴',
            '35678': '⣴',
            '3568': '⢴',
            '357': '⡔',
            '3578': '⣔',
            '358': '⢔',
            '36': '⠤',
            '367': '⡤',
            '3678': '⣤',
            '368': '⢤',
            '37': '⡄',
            '378': '⣄',
            '38': '⢄',
            '4': '⠈',
            '45': '⠘',
            '456': '⠸',
            '4567': '⡸',
            '45678': '⣸',
            '4568': '⢸',
            '457': '⡘',
            '4578': '⣘',
            '458': '⢘',
            '46': '⠨',
            '467': '⡨',
            '4678': '⣨',
            '468': '⢨',
            '47': '⡈',
            '478': '⣈',
            '48': '⢈',
            '5': '⠐',
            '56': '⠰',
            '567': '⡰',
            '5678': '⣰',
            '568': '⢰',
            '57': '⡐',
            '578': '⣐',
            '58': '⢐',
            '6': '⠠',
            '67': '⡠',
            '678': '⣠',
            '68': '⢠',
            '7': '⡀',
            '78': '⣀',
            '8': '⢀',
        }
	def tobraille(self):
		'''
		เอา [1,2,3,4] มาเป็น 1234 เรียงจากน้อยไปมาก
		'''
		if len(self.data) > 1 and isinstance(self.inputdata, list):
			self.data1 =''
			for o in self.data:
				self.data1 += self.db[''.join(str(''.join(o)))]
			return self.data1
		else:
			self.data1 = ''.join(self.data) # แปลง list to str
			return self.db[self.data1]
	def printbraille(self):
		'''
		กลับด้านตัวเลข (Mirror dots for printing)
		International standard: swap 1↔4, 2↔5, 3↔6, 7↔8
		'''
		self.chage={'1':'4','2':'5','3':'6','4':'1','5':'2','6':'3','7':'8','8':'7'}
		self.i=0
		self.aa=[]*len(self.data)
		if len(self.data) > 1 and isinstance(self.inputdata, list):
			self.data2=['']*len(self.data)
			while self.i < len(self.data):
				for a in self.data[self.i]:
					self.data2[self.i] += self.chage[a]
				self.data2[self.i]=sorted(self.data2[self.i])
				self.data2[self.i]=self.db[''.join(self.data2[self.i])]
				self.i+=1
			self.data2.reverse() # ทำการเรียงจากหลังไปหน้า
			return ''.join(self.data2)
		else:
			self.data2=['']
			for a in self.data:
				self.data2.append(self.chage[a])
			return self.db[''.join(sorted(self.data2))]
