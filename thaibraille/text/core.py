# -*- coding: utf-8 -*-
"""
Thai Braille Conversion Module

This module uses the international standard Braille dot numbering system:
  6-dot Braille cell:
    Left column:  1 (top), 2 (middle), 3 (bottom)
    Right column: 4 (top), 5 (middle), 6 (bottom)
  
  8-dot Braille cell (adds bottom row):
    Bottom row: 7 (left), 8 (right)

This follows the ISO/ANSI standard used internationally (EU, UK, US).
The Unicode Braille Patterns block (U+2800-U+28FF) also uses this numbering.
"""
import re
from pythainlp.util import Trie
from pythainlp.tokenize import word_tokenize

thai_braille_mapping_dict = {
    "ก":["1245"],
    "ข":["13"],
    "ฃ":["356", "13"],
    "ค":["136"],
    "ฅ":["36", "136"],
    "ฆ":["6", "136"],
    "ง":["12456"],
    "จ":["245"],
    "ฉ":["23"],
    "ช":["236"],
    "ซ":["2346"],
    "ฌ":["6", "236"],
    "ญ":["6", "12356"],
    "ฎ":["6", "125"],
    "ฏ":["6", "1456"],
    "ฐ":["6", "2345"],
    "ฑ":["6", "23456"],
    "ฒ":["36", "23456"],
    "ณ":["6", "1235"],
    "ด":["125"],
    "ต":["1456"],
    "ถ":["2345"],
    "ท":["23456"],
    "ธ":["356", "23456"],
    "น":["1235"],
    "บ":["1346"],
    "ป":["12346"],
    "ผ":["1234"],
    "ฝ":["1236"],
    "พ":["1256"],
    "ฟ":["1246"],
    "ภ":["6", "1256"],
    "ม":["123"],
    "ย":["12356"],
    "ร":["1345"],
    "ล":["134"],
    "ว":["2456"],
    "ศ":["6", "234"],
    "ษ":["36", "234"],
    "ส":["234"],
    "ห":["145"],
    "ฬ":["6", "134"],
    "อ":["135"],
    "ฮ":["123456"],
    "1":["1"],
    "2":["14"],
    "3":["12"],
    "4":["125"],
    "5":["15"],
    "6":["124"],
    "7":["1245"],
    "8":["145"],
    "9":["24"],
    "0":["245"],
    "๑":["1"],
    "๒":["14"],
    "๓":["12"],
    "๔":["125"],
    "๕":["15"],
    "๖":["124"],
    "๗":["1245"],
    "๘":["145"],
    "๙":["24"],
    "๐":["245"],
    "ะ":["1"],
    "า":["16"],
    "ิ":["14"],
    "ี":["34"],
    "ุ":["12"],
    "ู":["45"],
    "ึ":["246"],
    "ื":["46"],
    "เ":["124"],
    "โ":["24"],
    "ั":["235"],
    "ำ":["1356"],
    "แ":["146"],
    "ไ":["156"],
    "่":["35"],
    "้":["456"],
    "๊":["3456"],
    "๋":["346"],
    "์":["356"],
    "ๆ":["4"],
    " ":["-1"],
    "<N>":['2456']
}

dict_2 = {
    "เ-อ":["126"],
    "เ-ีย":["13456"],
    "เ-ือ":["12345"],
    "-ัว":["15"],
    "เ-า":["345"],
    "เ-าะ":['145', '1']
}

# number start with '2456'

def replace_number(word):
    if word[0] in list("1234567890๐๑๒๓๔๕๖๗๘๙"):
        return '<N>'+word
    return word

thai_braille_mapping_dict = dict(thai_braille_mapping_dict, **dict_2)

_v1=["เ-tอ", "เ-ีtย", "เ-ืtอ", "-ัtว", "เ-tา", "เ-tาะ"]

char_trie = Trie(list(thai_braille_mapping_dict.keys())+_v1+[" ","<N>"])


_vowel_patterns =[i.replace("-","([ก-ฮ])").replace("t","([่้๊๋])")+",\\1"+i.replace("t","")+"\\2" for i in _v1]
_vowel_patterns += [i.replace("-","([ก-ฮ])")+",\\1"+i for i in dict_2.keys()]
_VOWELS = [x.split(",") for x in _vowel_patterns]

def _replace_vowels(word: str) -> str:
    for vowel in _VOWELS:
        word = re.sub(vowel[0], vowel[1], word)

    return word

def thai_word_braille(word: str) -> str:
    word = _replace_vowels(word)
    word = replace_number(word)
    _temp = []
    for i in word_tokenize(word,custom_dict=char_trie, engine="mm"):
       if i.isspace() and len(i)>1:
        for k in list(i):
            _temp.append(thai_braille_mapping_dict[k])
       else:
        _temp.append(thai_braille_mapping_dict[i])
    _b = Braille(_temp)
    return _b.tobraille()


def thai_text_braille(text: str) -> list:
    _list_braille = []
    for word in word_tokenize(text):
        _list_braille.append(thai_word_braille(word))
    return _list_braille


class Braille:
	'''
    List Braille to Braille
	'''
	def __init__(self,data):
		self.inputdata=data
		if isinstance(data, list): # หากข้อมูลเป็นชนิด list
			if len(data)>1: # หากมี list มากกว่าหนึ่ง
				self.data =['']*len(data) # สร้าง list ซ้อน list ตามจำนวนที่มี
				self.i=0
				while self.i<len(data): # ทำการลูปตามจำนวน list ที่ซ้อนใน data
					self.data[self.i] = sorted(list(data[self.i])) #  ทำการแปลงข้อมูลใน list ให้เป็น list
					self.i+=1
			else: # หากมี ['12'] อันเดียว
				self.data =sorted(list(data[0]))
		else:
			self.data = sorted(list(data)) # แปลงเป็น list พร้อมเรียงจากน้อยไปมาก
		self.db = {
            "-1":" ",
            '0':'⠀',
            '1':'⠁',
            '4':'⠂',
            '14':'⠃',
            '3':'⠄',
            '13':'⠅',
            '34':'⠆',
            '134':'⠇',
            '2':'⠈',
            '12':'⠉',
            '24':'⠊',
            '124':'⠋',
            '23':'⠌',
            '123':'⠍',
            '234':'⠎',
            '1234':'⠏',
            '⠐':'4',
            '15':'⠑',
            '45':'⠒',
            '145':'⠓',
            '35':'⠔',
            '135':'⠕',
            '1345':'⠗',
            '25':'⠘',
            '125':'⠙',
            '245':'⠚',
            '1245':'⠛',
            '235':'⠜',
            '1235':'⠝',
            '2345':'⠞',
            '12345':'⠟',
            '6':'⠠',
            '16':'⠡',
            '46':'⠢',
            '146':'⠣',
            '36':'⠤',
            '136':'⠥',
            '346':'⠦',
            '1346':'⠧',
            '26':'⠨',
            '126':'⠩',
            '246':'⠪',
            '1246':'⠫',
            '236':'⠬',
            '1236':'⠭',
            '2346':'⠮',
            '12346':'⠯',
            '56':'⠰',
            '156':'⠱',
            '456':'⠲',
            '1456':'⠳',
            '356':'⠴',
            '1356':'⠵',
            '3456':'⠶',
            '13456':'⠷',
            '256':'⠸',
            '1256':'⠹',
            '2456':'⠺',
            '12456':'⠻',
            '2356':'⠼',
            '12356':'⠽',
            '23456':'⠾',
            '123456':'⠿',
            '7':'⡀',
            '17':'⡁',
            '47':'⡂',
            '147':'⡃',
            '37':'⡄',
            '137':'⡅',
            '347':'⡆',
            '1347':'⡇',
            '27':'⡈',
            '127':'⡉',
            '247':'⡊',
            '1247':'⡋',
            '237':'⡌',
            '1237':'⡍',
            '2347':'⡎',
            '12347':'⡏',
            '57':'⡐',
            '157':'⡑',
            '1237':'⡍',
            '2347':'⡎',
            '12347':'⡏',
            '57':'⡐',
            '157':'⡑',
            '457':'⡒',
            '1457':'⡓',
            '357':'⡔',
            '1357':'⡕',
            '3457':'⡖',
            '13457':'⡗',
            '257':'⡘',
            '1257':'⡙',
            '2457':'⡚',
            '12457':'⡛',
            '2357':'⡜',
            '12357':'⡝',
            '23457':'⡞',
            '123457':'⡟',
            '67':'⡠',
            '167':'⡡',
            '467':'⡢',
            '1467':'⡣',
            '367':'⡤',
            '1367':'⡥',
            '3467':'⡦',
            '13467':'⡧',
            '267':'⡨',
            '1267':'⡩',
            '2467':'⡪',
            '12467':'⡫',
            '2367':'⡬',
            '12367':'⡭',
            '23467':'⡮',
            '123467':'⡯',
            '567':'⡰',
            '1567':'⡱',
            '4567':'⡲',
            '14567':'⡳',
            '3567':'⡴',
            '13567':'⡵',
            '34567':'⡶',
            '134567':'⡷',
            '2567':'⡸',
            '12567':'⡹',
            '24567':'⡺',
            '124567':'⡻',
            '23567':'⡼',
            '123567':'⡽',
            '234567':'⡾',
            '1234567':'⡿',
            '8':'⢀',
            '18':'⢁',
            '48':'⢂',
            '148':'⢃',
            '38':'⢄',
            '138':'⢅',
            '348':'⢆',
            '1348':'⢇',
            '28':'⢈',
            '128':'⢉',
            '248':'⢊',
            '1248':'⢋',
            '238':'⢌',
            '1238':'⢍',
            '2348':'⢎',
            '12348':'⢏',
            '58':'⢐',
            '158':'⢑',
            '458':'⢒',
            '1458':'⢓',
            '358':'⢔',
            '1358':'⢕',
            '3458':'⢖',
            '13458':'⢗',
            '258':'⢘',
            '1258':'⢙',
            '2458':'⢚',
            '12458':'⢛',
            '2358':'⢜',
            '12358':'⢝',
            '23458':'⢞',
            '123458':'⢟',
            '68':'⢠',
            '168':'⢡',
            '468':'⢢',
            '1468':'⢣',
            '368':'⢤',
            '1368':'⢥',
            '3468':'⢦',
            '13468':'⢧',
            '268':'⢨',
            '1268':'⢩',
            '2468':'⢪',
            '12468':'⢫',
            '2368':'⢬',
            '12368':'⢭',
            '23468':'⢮',
            '123468':'⢯',
            '568':'⢰',
            '1568':'⢱',
            '4568':'⢲',
            '14568':'⢳',
            '3568':'⢴',
            '13568':'⢵',
            '34568':'⢶',
            '134568':'⢷',
            '2568':'⢸',
            '12568':'⢹',
            '24568':'⢺',
            '124568':'⢻',
            '23568':'⢼',
            '123568':'⢽',
            '234568':'⢾',
            '1234568':'⢿',
            '78':'⣀',
            '178':'⣁',
            '478':'⣂',
            '1478':'⣃',
            '378':'⣄',
            '1378':'⣅',
            '3478':'⣆',
            '13478':'⣇',
            '278':'⣈',
            '1278':'⣉',
            '2478':'⣊',
            '12478':'⣋',
            '2378':'⣌',
            '12378':'⣍',
            '23478':'⣎',
            '123478':'⣏',
            '578':'⣐',
            '1578':'⣑',
            '4578':'⣒',
            '14578':'⣓',
            '3578':'⣔',
            '13578':'⣕',
            '34578':'⣖',
            '134578':'⣗',
            '2578':'⣘',
            '12578':'⣙',
            '24578':'⣚',
            '124578':'⣛',
            '23578':'⣜',
            '123578':'⣝',
            '234578':'⣞',
            '1234578':'⣟',
            '678':'⣠',
            '1678':'⣡',
            '4678':'⣢',
            '14678':'⣣',
            '3678':'⣤',
            '13678':'⣥',
            '34678':'⣦',
            '134678':'⣧',
            '2678':'⣨',
            '12678':'⣩',
            '24678':'⣪',
            '124678':'⣫',
            '23678':'⣬',
            '123678':'⣭',
            '234678':'⣮',
            '1234678':'⣯',
            '5678':'⣰',
            '15678':'⣱',
            '45678':'⣲',
            '145678':'⣳',
            '35678':'⣴',
            '135678':'⣵',
            '345678':'⣶',
            '1345678':'⣷',
            '25678':'⣸',
            '125678':'⣹',
            '245678':'⣺',
            '1245678':'⣻',
            '235678':'⣼',
            '1235678':'⣽',
            '2345678':'⣾',
            '12345678':'⣿',
            '345':'⠖',
        }
	def tobraille(self):
		'''
		เอา [1,2,3,4] มาเป็น 1234 เรียงจากน้อยไปมาก
		'''
		if len(self.data) > 1 and isinstance(self.inputdata, list):
			self.data1 =''
			for o in self.data:
				self.data1 += self.db[''.join(str(''.join(o)))]
			return self.data1
		else:
			self.data1 = ''.join(self.data) # แปลง list to str
			return self.db[self.data1]
	def printbraille(self):
		'''
		กลับด้านตัวเลข
		'''
		self.chage={'1':'4','2':'5','3':'6','4':'1','5':'2','6':'3','7':'8','8':'7'}
		self.i=0
		self.aa=[]*len(self.data)
		if len(self.data) > 1 and isinstance(self.inputdata, list):
			self.data2=['']*len(self.data)
			while self.i < len(self.data):
				for a in self.data[self.i]:
					self.data2[self.i] += self.chage[a]
				self.data2[self.i]=sorted(self.data2[self.i])
				self.data2[self.i]=self.db[''.join(self.data2[self.i])]
				self.i+=1
			self.data2.reverse() # ทำการเรียงจากหลังไปหน้า
			return ''.join(self.data2)
		else:
			self.data2=['']
			for a in self.data:
				self.data2.append(self.chage[a])
			return self.db[''.join(sorted(self.data2))]
