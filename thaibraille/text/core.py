# -*- coding: utf-8 -*-
"""
Thai Braille Conversion Module

This module uses the international standard Braille dot numbering system:
  6-dot Braille cell:
    Left column:  1 (top), 2 (middle), 3 (bottom)
    Right column: 4 (top), 5 (middle), 6 (bottom)
  
  8-dot Braille cell (adds bottom row):
    Bottom row: 7 (left), 8 (right)

This follows the ISO/ANSI standard used internationally (EU, UK, US).
The Unicode Braille Patterns block (U+2800-U+28FF) also uses this numbering.
"""
import re
from pythainlp.util import Trie
from pythainlp.tokenize import word_tokenize

thai_braille_mapping_dict = {
    "ก":["1245"],
    "ข":["13"],
    "ฃ":["356", "13"],
    "ค":["136"],
    "ฅ":["36", "136"],
    "ฆ":["6", "136"],
    "ง":["12456"],
    "จ":["245"],
    "ฉ":["23"],
    "ช":["236"],
    "ซ":["2346"],
    "ฌ":["6", "236"],
    "ญ":["6", "12356"],
    "ฎ":["6", "125"],
    "ฏ":["6", "1456"],
    "ฐ":["6", "2345"],
    "ฑ":["6", "23456"],
    "ฒ":["36", "23456"],
    "ณ":["6", "1235"],
    "ด":["125"],
    "ต":["1456"],
    "ถ":["2345"],
    "ท":["23456"],
    "ธ":["356", "23456"],
    "น":["1235"],
    "บ":["1346"],
    "ป":["12346"],
    "ผ":["1234"],
    "ฝ":["1236"],
    "พ":["1256"],
    "ฟ":["1246"],
    "ภ":["6", "1256"],
    "ม":["123"],
    "ย":["12356"],
    "ร":["1345"],
    "ล":["134"],
    "ว":["2456"],
    "ศ":["6", "234"],
    "ษ":["36", "234"],
    "ส":["234"],
    "ห":["145"],
    "ฬ":["6", "134"],
    "อ":["135"],
    "ฮ":["123456"],
    "1":["1"],
    "2":["14"],
    "3":["12"],
    "4":["125"],
    "5":["15"],
    "6":["124"],
    "7":["1245"],
    "8":["145"],
    "9":["24"],
    "0":["245"],
    "๑":["1"],
    "๒":["14"],
    "๓":["12"],
    "๔":["125"],
    "๕":["15"],
    "๖":["124"],
    "๗":["1245"],
    "๘":["145"],
    "๙":["24"],
    "๐":["245"],
    "ะ":["1"],
    "า":["16"],
    "ิ":["14"],
    "ี":["34"],
    "ุ":["12"],
    "ู":["45"],
    "ึ":["246"],
    "ื":["46"],
    "เ":["124"],
    "โ":["24"],
    "ั":["235"],
    "ำ":["1356"],
    "แ":["146"],
    "ไ":["156"],
    "่":["35"],
    "้":["456"],
    "๊":["3456"],
    "๋":["346"],
    "์":["356"],
    "ๆ":["4"],
    " ":["-1"],
    "<N>":['2456']
}

dict_2 = {
    "เ-อ":["126"],
    "เ-ีย":["13456"],
    "เ-ือ":["12345"],
    "-ัว":["15"],
    "เ-า":["345"],
    "เ-าะ":['145', '1']
}

# number start with '2456'

def replace_number(word):
    if word[0] in list("1234567890๐๑๒๓๔๕๖๗๘๙"):
        return '<N>'+word
    return word

thai_braille_mapping_dict = dict(thai_braille_mapping_dict, **dict_2)

_v1=["เ-tอ", "เ-ีtย", "เ-ืtอ", "-ัtว", "เ-tา", "เ-tาะ"]

char_trie = Trie(list(thai_braille_mapping_dict.keys())+_v1+[" ","<N>"])


_vowel_patterns =[i.replace("-","([ก-ฮ])").replace("t","([่้๊๋])")+",\\1"+i.replace("t","")+"\\2" for i in _v1]
_vowel_patterns += [i.replace("-","([ก-ฮ])")+",\\1"+i for i in dict_2.keys()]
_VOWELS = [x.split(",") for x in _vowel_patterns]

def _replace_vowels(word: str) -> str:
    for vowel in _VOWELS:
        word = re.sub(vowel[0], vowel[1], word)

    return word

def thai_word_braille(word: str) -> str:
    word = _replace_vowels(word)
    word = replace_number(word)
    _temp = []
    for i in word_tokenize(word,custom_dict=char_trie, engine="mm"):
       if i.isspace() and len(i)>1:
        for k in list(i):
            _temp.append(thai_braille_mapping_dict[k])
       else:
        _temp.append(thai_braille_mapping_dict[i])
    _b = Braille(_temp)
    return _b.tobraille()


def thai_text_braille(text: str) -> list:
    _list_braille = []
    for word in word_tokenize(text):
        _list_braille.append(thai_word_braille(word))
    return _list_braille


class Braille:
	'''
    List Braille to Braille
	'''
	def __init__(self,data):
		self.inputdata=data
		if isinstance(data, list): # หากข้อมูลเป็นชนิด list
			if len(data)>1: # หากมี list มากกว่าหนึ่ง
				self.data =['']*len(data) # สร้าง list ซ้อน list ตามจำนวนที่มี
				self.i=0
				while self.i<len(data): # ทำการลูปตามจำนวน list ที่ซ้อนใน data
					self.data[self.i] = sorted(list(data[self.i])) #  ทำการแปลงข้อมูลใน list ให้เป็น list
					self.i+=1
			else: # หากมี ['12'] อันเดียว
				self.data =sorted(list(data[0]))
		else:
			self.data = sorted(list(data)) # แปลงเป็น list พร้อมเรียงจากน้อยไปมาก
		self.db = {
            '0':'⠀',
            '1':'⠁',
            '2':'⠂',
            '3':'⠄',
            '4':'⠈',
            '5':'⠐',
            '6':'⠠',
            '7':'⡀',
            '8':'⢀',
            '-1':' ',
            '12':'⠃',
            '13':'⠅',
            '14':'⠉',
            '15':'⠑',
            '16':'⠡',
            '17':'⡁',
            '18':'⢁',
            '23':'⠆',
            '24':'⠊',
            '25':'⠒',
            '26':'⠢',
            '27':'⡂',
            '28':'⢂',
            '34':'⠌',
            '35':'⠔',
            '36':'⠤',
            '37':'⡄',
            '38':'⢄',
            '45':'⠘',
            '46':'⠨',
            '47':'⡈',
            '48':'⢈',
            '56':'⠰',
            '57':'⡐',
            '58':'⢐',
            '67':'⡠',
            '68':'⢠',
            '78':'⣀',
            '123':'⠇',
            '124':'⠋',
            '125':'⠓',
            '126':'⠣',
            '127':'⡃',
            '128':'⢃',
            '134':'⠍',
            '135':'⠕',
            '136':'⠥',
            '137':'⡅',
            '138':'⢅',
            '145':'⠙',
            '146':'⠩',
            '147':'⡉',
            '148':'⢉',
            '156':'⠱',
            '157':'⡑',
            '158':'⢑',
            '167':'⡡',
            '168':'⢡',
            '178':'⣁',
            '234':'⠎',
            '235':'⠖',
            '236':'⠦',
            '237':'⡆',
            '238':'⢆',
            '245':'⠚',
            '246':'⠪',
            '247':'⡊',
            '248':'⢊',
            '256':'⠲',
            '257':'⡒',
            '258':'⢒',
            '267':'⡢',
            '268':'⢢',
            '278':'⣂',
            '345':'⠜',
            '346':'⠬',
            '347':'⡌',
            '348':'⢌',
            '356':'⠴',
            '357':'⡔',
            '358':'⢔',
            '367':'⡤',
            '368':'⢤',
            '378':'⣄',
            '456':'⠸',
            '457':'⡘',
            '458':'⢘',
            '467':'⡨',
            '468':'⢨',
            '478':'⣈',
            '567':'⡰',
            '568':'⢰',
            '578':'⣐',
            '678':'⣠',
            '1234':'⠏',
            '1235':'⠗',
            '1236':'⠧',
            '1237':'⡇',
            '1238':'⢇',
            '1245':'⠛',
            '1246':'⠫',
            '1247':'⡋',
            '1248':'⢋',
            '1256':'⠳',
            '1257':'⡓',
            '1258':'⢓',
            '1267':'⡣',
            '1268':'⢣',
            '1278':'⣃',
            '1345':'⠝',
            '1346':'⠭',
            '1347':'⡍',
            '1348':'⢍',
            '1356':'⠵',
            '1357':'⡕',
            '1358':'⢕',
            '1367':'⡥',
            '1368':'⢥',
            '1378':'⣅',
            '1456':'⠹',
            '1457':'⡙',
            '1458':'⢙',
            '1467':'⡩',
            '1468':'⢩',
            '1478':'⣉',
            '1567':'⡱',
            '1568':'⢱',
            '1578':'⣑',
            '1678':'⣡',
            '2345':'⠞',
            '2346':'⠮',
            '2347':'⡎',
            '2348':'⢎',
            '2356':'⠶',
            '2357':'⡖',
            '2358':'⢖',
            '2367':'⡦',
            '2368':'⢦',
            '2378':'⣆',
            '2456':'⠺',
            '2457':'⡚',
            '2458':'⢚',
            '2467':'⡪',
            '2468':'⢪',
            '2478':'⣊',
            '2567':'⡲',
            '2568':'⢲',
            '2578':'⣒',
            '2678':'⣢',
            '3456':'⠼',
            '3457':'⡜',
            '3458':'⢜',
            '3467':'⡬',
            '3468':'⢬',
            '3478':'⣌',
            '3567':'⡴',
            '3568':'⢴',
            '3578':'⣔',
            '3678':'⣤',
            '4567':'⡸',
            '4568':'⢸',
            '4578':'⣘',
            '4678':'⣨',
            '5678':'⣰',
            '12345':'⠟',
            '12346':'⠯',
            '12347':'⡏',
            '12348':'⢏',
            '12356':'⠷',
            '12357':'⡗',
            '12358':'⢗',
            '12367':'⡧',
            '12368':'⢧',
            '12378':'⣇',
            '12456':'⠻',
            '12457':'⡛',
            '12458':'⢛',
            '12467':'⡫',
            '12468':'⢫',
            '12478':'⣋',
            '12567':'⡳',
            '12568':'⢳',
            '12578':'⣓',
            '12678':'⣣',
            '13456':'⠽',
            '13457':'⡝',
            '13458':'⢝',
            '13467':'⡭',
            '13468':'⢭',
            '13478':'⣍',
            '13567':'⡵',
            '13568':'⢵',
            '13578':'⣕',
            '13678':'⣥',
            '14567':'⡹',
            '14568':'⢹',
            '14578':'⣙',
            '14678':'⣩',
            '15678':'⣱',
            '23456':'⠾',
            '23457':'⡞',
            '23458':'⢞',
            '23467':'⡮',
            '23468':'⢮',
            '23478':'⣎',
            '23567':'⡶',
            '23568':'⢶',
            '23578':'⣖',
            '23678':'⣦',
            '24567':'⡺',
            '24568':'⢺',
            '24578':'⣚',
            '24678':'⣪',
            '25678':'⣲',
            '34567':'⡼',
            '34568':'⢼',
            '34578':'⣜',
            '34678':'⣬',
            '35678':'⣴',
            '45678':'⣸',
            '123456':'⠿',
            '123457':'⡟',
            '123458':'⢟',
            '123467':'⡯',
            '123468':'⢯',
            '123478':'⣏',
            '123567':'⡷',
            '123568':'⢷',
            '123578':'⣗',
            '123678':'⣧',
            '124567':'⡻',
            '124568':'⢻',
            '124578':'⣛',
            '124678':'⣫',
            '125678':'⣳',
            '134567':'⡽',
            '134568':'⢽',
            '134578':'⣝',
            '134678':'⣭',
            '135678':'⣵',
            '145678':'⣹',
            '234567':'⡾',
            '234568':'⢾',
            '234578':'⣞',
            '234678':'⣮',
            '235678':'⣶',
            '245678':'⣺',
            '345678':'⣼',
            '1234567':'⡿',
            '1234568':'⢿',
            '1234578':'⣟',
            '1234678':'⣯',
            '1235678':'⣷',
            '1245678':'⣻',
            '1345678':'⣽',
            '2345678':'⣾',
            '12345678':'⣿',
        }
	def tobraille(self):
		'''
		เอา [1,2,3,4] มาเป็น 1234 เรียงจากน้อยไปมาก
		'''
		if len(self.data) > 1 and isinstance(self.inputdata, list):
			self.data1 =''
			for o in self.data:
				self.data1 += self.db[''.join(str(''.join(o)))]
			return self.data1
		else:
			self.data1 = ''.join(self.data) # แปลง list to str
			return self.db[self.data1]
	def printbraille(self):
		'''
		กลับด้านตัวเลข
		'''
		self.chage={'1':'4','2':'5','3':'6','4':'1','5':'2','6':'3','7':'8','8':'7'}
		self.i=0
		self.aa=[]*len(self.data)
		if len(self.data) > 1 and isinstance(self.inputdata, list):
			self.data2=['']*len(self.data)
			while self.i < len(self.data):
				for a in self.data[self.i]:
					self.data2[self.i] += self.chage[a]
				self.data2[self.i]=sorted(self.data2[self.i])
				self.data2[self.i]=self.db[''.join(self.data2[self.i])]
				self.i+=1
			self.data2.reverse() # ทำการเรียงจากหลังไปหน้า
			return ''.join(self.data2)
		else:
			self.data2=['']
			for a in self.data:
				self.data2.append(self.chage[a])
			return self.db[''.join(sorted(self.data2))]
